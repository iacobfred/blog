/* Do not edit this file. It was generated programmatically. */

import { MutationHookOptions } from "@apollo/client";
import {
  CREATE_IDENTITY,
  UPDATE_IDENTITY,
  updateCacheAfterCreatingIdentity,
} from "@web/graphql/generated/mutations/identity.mutations";
import { IdentityFragment } from "@web/graphql/generated/fragments/identity.fragment";
import {
  IdentityCreationArgs,
  IdentityUpdateArgs,
} from "@web/graphql/generated/args/identity.args";
import { useHandleMutation } from "@web/utils/data/mutation";
import { Payload, ArrayAction } from "@web/utils/data/reduction";
import { useEffect, useReducer, Dispatch } from "react";
import {
  identityReducer,
  identitiesReducer,
  IdentityData,
  initializeIdentityData,
} from "@web/generated/reducers/identity.reducer";
import { useUser } from "@web/components/contexts/UserContext";
import {
  identityCreationInputSchema,
  identityUpdateInputSchema,
} from "@web/graphql/generated/schemas/identity.schemas";
import { getOptimisticResponseForIdentityCreation } from "@web/graphql/generated/mutations/identity.mutations";

type IdentityCreationMutationHookOptions = MutationHookOptions<
  { createIdentity: IdentityFragment },
  IdentityCreationArgs
>;

export const useCreateIdentity = (options?: IdentityCreationMutationHookOptions) => {
  return useHandleMutation<{ createIdentity: IdentityFragment }, IdentityCreationArgs>(
    CREATE_IDENTITY,
    { ...updateCacheAfterCreatingIdentity, ...(options ?? {}) },
    identityCreationInputSchema,
    getOptimisticResponseForIdentityCreation
  );
};

type IdentityUpdateMutationHookOptions = MutationHookOptions<
  { updateIdentity: IdentityFragment },
  IdentityUpdateArgs
>;

export const useUpdateIdentity = (options?: IdentityUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateIdentity: IdentityFragment }, IdentityUpdateArgs>(
    UPDATE_IDENTITY,
    options,
    identityUpdateInputSchema
  );
};

export const useIdentityReducer = (
  data?: IdentityData
): [IdentityData, Dispatch<Payload<IdentityData>>] => {
  const { user } = useUser();
  const [identityData, dispatchIdentityData] = useReducer(
    identityReducer,
    data ?? {},
    initializeIdentityData
  );
  useEffect(() => {
    if (!user) return;
    if (!identityData?.userId) {
      dispatchIdentityData({
        field: "init",
        value: initializeIdentityData(identityData, user),
      });
    }
  }, [user, identityData]);
  return [identityData, dispatchIdentityData];
};

export const useIdentitiesReducer = (
  data: IdentityFragment[]
): [IdentityFragment[], Dispatch<ArrayAction<IdentityFragment>>] => {
  return useReducer(identitiesReducer, data);
};
