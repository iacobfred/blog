/* Do not edit this file. It was generated programmatically. */

import { MutationHookOptions } from "@apollo/client";
import { useUser } from "@web/components/contexts/UserContext";
import {
  NotebookCreationArgs,
  NotebookUpdateArgs,
} from "@web/generated/graphql/args/notebook.args";
import { NotebookFragment } from "@web/generated/graphql/fragments/notebook.fragment";
import {
  CREATE_NOTEBOOK,
  getOptimisticResponseForNotebookCreation,
  updateCacheAfterCreatingNotebook,
  UPDATE_NOTEBOOK,
} from "@web/generated/graphql/mutations/notebook.mutations";
import {
  notebookCreationInputSchema,
  notebookUpdateInputSchema,
} from "@web/generated/graphql/schemas/notebook.schemas";
import {
  initializeNotebookData,
  NotebookData,
  notebookReducer,
  notebooksReducer,
} from "@web/generated/reducers/notebook.reducer";
import { useHandleMutation } from "@web/utils/data/mutation";
import { ArrayAction, Payload } from "@web/utils/data/reduction";
import { Dispatch, useEffect, useReducer } from "react";

type NotebookCreationMutationHookOptions = MutationHookOptions<
  { createNotebook: NotebookFragment },
  NotebookCreationArgs
>;

export const useCreateNotebook = (options?: NotebookCreationMutationHookOptions) => {
  return useHandleMutation<{ createNotebook: NotebookFragment }, NotebookCreationArgs>(
    CREATE_NOTEBOOK,
    { ...updateCacheAfterCreatingNotebook, ...(options ?? {}) },
    notebookCreationInputSchema,
    getOptimisticResponseForNotebookCreation
  );
};

type NotebookUpdateMutationHookOptions = MutationHookOptions<
  { updateNotebook: NotebookFragment },
  NotebookUpdateArgs
>;

export const useUpdateNotebook = (options?: NotebookUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateNotebook: NotebookFragment }, NotebookUpdateArgs>(
    UPDATE_NOTEBOOK,
    { refetchQueries: ["GetUser"], ...(options ?? {}) },
    notebookUpdateInputSchema
  );
};

export const useNotebookReducer = (
  data?: NotebookData
): [NotebookData, Dispatch<Payload<NotebookData>>] => {
  const { user } = useUser();
  const [notebookData, dispatchNotebookData] = useReducer(
    notebookReducer,
    data ?? {},
    initializeNotebookData
  );
  useEffect(() => {
    if (!user) return;
    if (!notebookData?.userId) {
      dispatchNotebookData({
        field: "init",
        value: initializeNotebookData(notebookData, user),
      });
    }
  }, [user, notebookData]);
  return [notebookData, dispatchNotebookData];
};

export const useNotebooksReducer = (
  data: NotebookFragment[]
): [NotebookFragment[], Dispatch<ArrayAction<NotebookFragment>>] => {
  return useReducer(notebooksReducer, data);
};
