/* Do not edit this file. It was generated programmatically. */

import { MutationHookOptions } from "@apollo/client";
import {
  CREATE_MANTRA,
  UPDATE_MANTRA,
  updateCacheAfterCreatingMantra,
} from "@web/graphql/generated/mutations/mantra.mutations";
import { MantraFragment } from "@web/graphql/generated/fragments/mantra.fragment";
import { MantraCreationArgs, MantraUpdateArgs } from "@web/graphql/generated/args/mantra.args";
import { useHandleMutation } from "@web/utils/data/mutation";
import { Payload, ArrayAction } from "@web/utils/data/reduction";
import { useEffect, useReducer, Dispatch } from "react";
import {
  mantraReducer,
  mantrasReducer,
  MantraData,
  initializeMantraData,
} from "@web/generated/reducers/mantra.reducer";
import { useUser } from "@web/components/contexts/UserContext";
import {
  mantraCreationInputSchema,
  mantraUpdateInputSchema,
} from "@web/graphql/generated/schemas/mantra.schemas";
import { getOptimisticResponseForMantraCreation } from "@web/graphql/generated/mutations/mantra.mutations";

type MantraCreationMutationHookOptions = MutationHookOptions<
  { createMantra: MantraFragment },
  MantraCreationArgs
>;

export const useCreateMantra = (options?: MantraCreationMutationHookOptions) => {
  return useHandleMutation<{ createMantra: MantraFragment }, MantraCreationArgs>(
    CREATE_MANTRA,
    { ...updateCacheAfterCreatingMantra, ...(options ?? {}) },
    mantraCreationInputSchema,
    getOptimisticResponseForMantraCreation
  );
};

type MantraUpdateMutationHookOptions = MutationHookOptions<
  { updateMantra: MantraFragment },
  MantraUpdateArgs
>;

export const useUpdateMantra = (options?: MantraUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateMantra: MantraFragment }, MantraUpdateArgs>(
    UPDATE_MANTRA,
    options,
    mantraUpdateInputSchema
  );
};

export const useMantraReducer = (
  data?: MantraData
): [MantraData, Dispatch<Payload<MantraData>>] => {
  const { user } = useUser();
  const [mantraData, dispatchMantraData] = useReducer(
    mantraReducer,
    data ?? {},
    initializeMantraData
  );
  useEffect(() => {
    if (!user) return;
    if (!mantraData?.userId) {
      dispatchMantraData({
        field: "init",
        value: initializeMantraData(mantraData, user),
      });
    }
  }, [user, mantraData]);
  return [mantraData, dispatchMantraData];
};

export const useMantrasReducer = (
  data: MantraFragment[]
): [MantraFragment[], Dispatch<ArrayAction<MantraFragment>>] => {
  return useReducer(mantrasReducer, data);
};
