/* Do not edit this file. It was generated programmatically. */

import { gql, MutationHookOptions } from "@apollo/client";
import { habitFragment, HabitFragment } from "@web/graphql/generated/fragments/habit.fragment";
import { HabitCreationArgs } from "@web/graphql/generated/args/habit.args";
import { HabitCreationInput, HabitUpdateInput } from "@web/graphql/generated/inputs/habit.inputs";

export const CREATE_HABIT = gql`
  mutation CreateHabit($data: HabitCreationInput!) {
    createHabit(data: $data) {
      ...HabitFragment
    }
  }
  ${habitFragment}
`;

export const getOptimisticResponseForHabitCreation = (
  data: HabitCreationInput
): { createHabit: HabitFragment } => {
  const now = new Date();
  return {
    createHabit: {
      __typename: "Habit",
      id: "tmp-id",
      description: null,
      public: false,
      cron: null,
      defaultDurationInMinutes: null,
      archivedAt: null,
      ...data,
      createdAt: now,
      updatedAt: now,
    },
  };
};

export const updateCacheAfterCreatingHabit: MutationHookOptions<
  { createHabit: HabitFragment },
  HabitCreationArgs
> = {
  update(cache, { data }) {
    const { createHabit } = data || {};
    if (createHabit) {
      const newHabitRef = cache.writeFragment({
        data: createHabit,
        fragment: gql`
          fragment NewHabit on Habit {
            ...HabitFragment
          }
          ${habitFragment}
        `,
        fragmentName: "NewHabit",
      });
      cache.modify({
        id: `User:${createHabit.userId}`,
        fields: {
          habits(existingHabitRefs = []) {
            return [...existingHabitRefs, newHabitRef];
          },
        },
      });
      cache.modify({
        fields: {
          habits(existingHabits = []) {
            return [...existingHabits, newHabitRef];
          },
        },
      });
    }
  },
};

export const UPDATE_HABIT = gql`
  mutation UpdateHabit($where: HabitWhereUniqueInput!, $data: HabitUpdateInput!) {
    updateHabit(where: $where, data: $data) {
      ...HabitFragment
    }
  }
  ${habitFragment}
`;

export const getOptimisticResponseForHabitUpdate = (
  fragment: HabitFragment,
  data: HabitUpdateInput
) => {
  const now = new Date();
  return {
    updateHabit: {
      __typename: "Habit",
      ...fragment,
      ...data,
      updatedAt: now,
    },
  };
};

export const UPSERT_HABIT = gql`
  mutation UpdateHabit($where: HabitWhereUniqueInput!, $data: HabitCreationInput!) {
    upsertHabit(where: $where, data: $data) {
      ...HabitFragment
    }
  }
  ${habitFragment}
`;

export const UPDATE_HABITS = gql`
  mutation UpdateHabits($where: HabitWhereInput!, $data: HabitUpdateInput!) {
    updateHabits(where: $where, data: $data) {
      ...HabitFragment
    }
  }
  ${habitFragment}
`;

export const UPDATE_HABITS_DISTINCTLY = gql`
  mutation UpdateHabitsDistinctly($data: [HabitUpdateInput!]!) {
    updateHabitsDistinctly(data: $data) {
      ...HabitFragment
    }
  }
  ${habitFragment}
`;
