/* Do not edit this file. It was generated programmatically. */

import { MutationHookOptions } from "@apollo/client";
import { useUser } from "@web/components/contexts/UserContext";
import { BeliefCreationArgs, BeliefUpdateArgs } from "@web/graphql/generated/args/belief.args";
import { BeliefFragment } from "@web/graphql/generated/fragments/belief.fragment";
import {
  CREATE_BELIEF,
  getOptimisticResponseForBeliefCreation,
  updateCacheAfterCreatingBelief,
  UPDATE_BELIEF,
} from "@web/graphql/generated/mutations/belief.mutations";
import {
  BeliefData,
  beliefReducer,
  beliefsReducer,
  initializeBeliefData,
} from "@web/graphql/generated/reducers/belief.reducer";
import {
  beliefCreationInputSchema,
  beliefUpdateInputSchema,
} from "@web/graphql/generated/schemas/belief.schemas";
import { useHandleMutation } from "@web/utils/data/mutation";
import { ArrayAction, Payload } from "@web/utils/data/reduction";
import { Dispatch, useEffect, useReducer } from "react";

type BeliefCreationMutationHookOptions = MutationHookOptions<
  { createBelief: BeliefFragment },
  BeliefCreationArgs
>;

export const useCreateBelief = (options?: BeliefCreationMutationHookOptions) => {
  return useHandleMutation<{ createBelief: BeliefFragment }, BeliefCreationArgs>(
    CREATE_BELIEF,
    { ...updateCacheAfterCreatingBelief, ...(options ?? {}) },
    beliefCreationInputSchema,
    getOptimisticResponseForBeliefCreation
  );
};

type BeliefUpdateMutationHookOptions = MutationHookOptions<
  { updateBelief: BeliefFragment },
  BeliefUpdateArgs
>;

export const useUpdateBelief = (options?: BeliefUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateBelief: BeliefFragment }, BeliefUpdateArgs>(
    UPDATE_BELIEF,
    options,
    beliefUpdateInputSchema
  );
};

export const useBeliefReducer = (
  data?: BeliefData
): [BeliefData, Dispatch<Payload<BeliefData>>] => {
  const { user } = useUser();
  const starterData = data ?? {};
  const initializedData = initializeBeliefData(starterData, user);
  const [beliefData, dispatchBeliefData] = useReducer(
    beliefReducer,
    initializedData,
    initializeBeliefData
  );
  useEffect(() => {
    if (user?.id && !beliefData?.userId) {
      dispatchBeliefData({
        field: "init",
        value: initializeBeliefData(beliefData, user),
      });
    }
  }, [user, beliefData]);
  return [beliefData, dispatchBeliefData];
};

export const useBeliefsReducer = (
  data: BeliefFragment[]
): [BeliefFragment[], Dispatch<ArrayAction<BeliefFragment>>] => {
  return useReducer(beliefsReducer, data);
};
