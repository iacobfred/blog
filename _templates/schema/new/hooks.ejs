---
to: generated/hooks/<%= name %>.hooks.ts
force: true
---
<% NAME = h.changeCase.constantCase(name); -%>
/* Do not edit this file. It was generated programmatically. */

import { MutationHookOptions } from "@apollo/client";
import { 
  CREATE_<%= NAME %>,
  UPDATE_<%= NAME %>,
  updateCacheAfterCreating<%= Name %>,
} from "@/generated/mutations/<%= name %>.mutations";
import { <%= Name %>Fragment } from "@/generated/fragments/<%= name %>.fragment";
import { <%= Name %>CreationArgs, <%= Name %>UpdateArgs } from "@/generated/args/<%= name %>.args";
import { useHandleMutation, Payload } from "@/utils/data";
import { useEffect, useReducer, Dispatch } from "react";
import { 
  <%= name %>DataReducer,
  <%= Name %>Data,
  initialize<%= Name %>Data,
} from "@/generated/reducers/<%= name %>.reducer";
<% if (Object.keys(fields).includes("userId")) { -%>
// import { useUser } from "@/components/contexts/UserContext";
<% } -%>

type <%= Name %>CreationMutationHookOptions = MutationHookOptions<
  { create<%= Name %>: <%= Name %>Fragment },
  <%= Name %>CreationArgs
>;

export const useCreate<%= Name %> = (options?: <%= Name %>CreationMutationHookOptions) => {
  return useHandleMutation<
    { create<%= Name %>: <%= Name %>Fragment },
    <%= Name %>CreationArgs
  >(CREATE_<%= NAME %>, {
    ...updateCacheAfterCreating<%= Name %>,
    ...(options ?? {}),
  });
}

type <%= Name %>UpdateMutationHookOptions = MutationHookOptions<
  { update<%= Name %>: <%= Name %>Fragment },
  <%= Name %>UpdateArgs
>;

export const useUpdate<%= Name %> = (options?: <%= Name %>UpdateMutationHookOptions) => {
  return useHandleMutation<
    { update<%= Name %>: <%= Name %>Fragment },
    <%= Name %>UpdateArgs
  >(UPDATE_<%= NAME %>, options);
}

export const use<%= Name %>DataReducer = (data: <%= Name %>Data): [<%= Name %>Data, Dispatch<Payload<<%= Name %>Data>>] => {
  const initialData = initialize<%= Name %>Data(data);
  const [<%= name %>Data, dispatch<%= Name %>Data] = useReducer(
    <%= name %>DataReducer,
    initialData,
    initialize<%= Name %>Data,
  );
<% if (Object.keys(fields).includes("userId")) { -%>
  useEffect(() => {
    if (data.userId && !<%= name %>Data?.userId) {
      console.log("Dispatching <%= name %> data!");
      dispatch<%= Name %>Data({ field: "init", value: data });
    }
  }, [data, <%= name %>Data]);
<% } -%>
  return [<%= name %>Data, dispatch<%= Name %>Data];
}
