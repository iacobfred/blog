/* Do not edit this file. It was generated programmatically. */

import { useUser } from "@/components/contexts/UserContext";
import { TaskCreationArgs, TaskUpdateArgs } from "@/graphql/generated/args/task.args";
import { TaskFragment } from "@/graphql/generated/fragments/task.fragment";
import {
  CREATE_TASK,
  getOptimisticResponseForTaskCreation,
  updateCacheAfterCreatingTask,
  UPDATE_TASK,
} from "@/graphql/generated/mutations/task.mutations";
import {
  initializeTaskData,
  TaskData,
  taskReducer,
  tasksReducer,
} from "@/graphql/generated/reducers/task.reducer";
import {
  taskCreationInputSchema,
  taskUpdateInputSchema,
} from "@/graphql/generated/schemas/task.schemas";
import { useHandleMutation } from "@/utils/data/mutation";
import { ArrayAction, Payload } from "@/utils/data/reduction";
import { MutationHookOptions } from "@apollo/client";
import { Dispatch, useEffect, useReducer } from "react";

type TaskCreationMutationHookOptions = MutationHookOptions<
  { createTask: TaskFragment },
  TaskCreationArgs
>;

export const useCreateTask = (options?: TaskCreationMutationHookOptions) => {
  return useHandleMutation<{ createTask: TaskFragment }, TaskCreationArgs>(
    CREATE_TASK,
    { ...updateCacheAfterCreatingTask, ...(options ?? {}) },
    taskCreationInputSchema,
    getOptimisticResponseForTaskCreation
  );
};

type TaskUpdateMutationHookOptions = MutationHookOptions<
  { updateTask: TaskFragment },
  TaskUpdateArgs
>;

export const useUpdateTask = (options?: TaskUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateTask: TaskFragment }, TaskUpdateArgs>(
    UPDATE_TASK,
    options,
    taskUpdateInputSchema
  );
};

export const useTaskReducer = (data?: TaskData): [TaskData, Dispatch<Payload<TaskData>>] => {
  const { user } = useUser();
  const starterData = data ?? {};
  const initializedData = initializeTaskData(starterData, user);
  const [taskData, dispatchTaskData] = useReducer(taskReducer, initializedData, initializeTaskData);
  useEffect(() => {
    if (user?.id && !taskData?.userId) {
      dispatchTaskData({
        field: "init",
        value: initializeTaskData(taskData, user),
      });
    }
  }, [user, taskData]);
  return [taskData, dispatchTaskData];
};

export const useTasksReducer = (
  data: TaskFragment[]
): [TaskFragment[], Dispatch<ArrayAction<TaskFragment>>] => {
  return useReducer(tasksReducer, data);
};
