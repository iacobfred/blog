/* Do not edit this file. It was generated programmatically. */

import { useUser } from "@/components/contexts/UserContext";
import { BeliefCreationArgs, BeliefUpdateArgs } from "@/graphql/generated/args/belief.args";
import { BeliefFragment } from "@/graphql/generated/fragments/belief.fragment";
import {
  CREATE_BELIEF,
  updateCacheAfterCreatingBelief,
  UPDATE_BELIEF,
} from "@/graphql/generated/mutations/belief.mutations";
import {
  BeliefData,
  beliefDataReducer,
  initializeBeliefData,
} from "@/graphql/generated/reducers/belief.reducer";
import { beliefCreationInputSchema } from "@/graphql/generated/schemas/belief.schemas";
import { Payload, useHandleMutation } from "@/utils/data";
import { MutationHookOptions } from "@apollo/client";
import { Dispatch, useEffect, useReducer } from "react";

type BeliefCreationMutationHookOptions = MutationHookOptions<
  { createBelief: BeliefFragment },
  BeliefCreationArgs
>;

export const useCreateBelief = (options?: BeliefCreationMutationHookOptions) => {
  return useHandleMutation<{ createBelief: BeliefFragment }, BeliefCreationArgs>(
    CREATE_BELIEF,
    { ...updateCacheAfterCreatingBelief, ...(options ?? {}) },
    beliefCreationInputSchema.validate
  );
};

type BeliefUpdateMutationHookOptions = MutationHookOptions<
  { updateBelief: BeliefFragment },
  BeliefUpdateArgs
>;

export const useUpdateBelief = (options?: BeliefUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateBelief: BeliefFragment }, BeliefUpdateArgs>(
    UPDATE_BELIEF,
    options
  );
};

export const useBeliefDataReducer = (
  data?: BeliefData
): [BeliefData, Dispatch<Payload<BeliefData>>] => {
  const user = useUser();
  const starterData = data ?? {};
  const initializedData = initializeBeliefData(starterData, user);
  const [beliefData, dispatchBeliefData] = useReducer(
    beliefDataReducer,
    initializedData,
    initializeBeliefData
  );
  useEffect(() => {
    if (user?.id && !beliefData?.userId) {
      dispatchBeliefData({
        field: "init",
        value: initializeBeliefData(beliefData, user),
      });
    }
  }, [user, beliefData]);
  return [beliefData, dispatchBeliefData];
};
