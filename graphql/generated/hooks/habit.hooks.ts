/* Do not edit this file. It was generated programmatically. */

import { useUser } from "@/components/contexts/UserContext";
import { HabitCreationArgs, HabitUpdateArgs } from "@/graphql/generated/args/habit.args";
import { HabitFragment } from "@/graphql/generated/fragments/habit.fragment";
import {
  CREATE_HABIT,
  getOptimisticResponseForHabitCreation,
  updateCacheAfterCreatingHabit,
  UPDATE_HABIT,
} from "@/graphql/generated/mutations/habit.mutations";
import {
  HabitData,
  habitReducer,
  initializeHabitData,
} from "@/graphql/generated/reducers/habit.reducer";
import {
  habitCreationInputSchema,
  habitUpdateInputSchema,
} from "@/graphql/generated/schemas/habit.schemas";
import { useHandleMutation } from "@/utils/data/mutation";
import { Payload } from "@/utils/data/reduction";
import { MutationHookOptions } from "@apollo/client";
import { Dispatch, useEffect, useReducer } from "react";

type HabitCreationMutationHookOptions = MutationHookOptions<
  { createHabit: HabitFragment },
  HabitCreationArgs
>;

export const useCreateHabit = (options?: HabitCreationMutationHookOptions) => {
  return useHandleMutation<{ createHabit: HabitFragment }, HabitCreationArgs>(
    CREATE_HABIT,
    { ...updateCacheAfterCreatingHabit, ...(options ?? {}) },
    habitCreationInputSchema,
    getOptimisticResponseForHabitCreation
  );
};

type HabitUpdateMutationHookOptions = MutationHookOptions<
  { updateHabit: HabitFragment },
  HabitUpdateArgs
>;

export const useUpdateHabit = (options?: HabitUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateHabit: HabitFragment }, HabitUpdateArgs>(
    UPDATE_HABIT,
    options,
    habitUpdateInputSchema
  );
};

export const useHabitReducer = (data?: HabitData): [HabitData, Dispatch<Payload<HabitData>>] => {
  const { user } = useUser();
  const starterData = data ?? {};
  const initializedData = initializeHabitData(starterData, user);
  const [habitData, dispatchHabitData] = useReducer(
    habitReducer,
    initializedData,
    initializeHabitData
  );
  useEffect(() => {
    if (user?.id && !habitData?.userId) {
      dispatchHabitData({
        field: "init",
        value: initializeHabitData(habitData, user),
      });
    }
  }, [user, habitData]);
  return [habitData, dispatchHabitData];
};
