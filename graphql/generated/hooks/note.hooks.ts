/* Do not edit this file. It was generated programmatically. */

import { useUser } from "@/components/contexts/UserContext";
import { NoteCreationArgs, NoteUpdateArgs } from "@/graphql/generated/args/note.args";
import { NoteFragment } from "@/graphql/generated/fragments/note.fragment";
import {
  CREATE_NOTE,
  updateCacheAfterCreatingNote,
  UPDATE_NOTE,
} from "@/graphql/generated/mutations/note.mutations";
import {
  initializeNoteData,
  NoteData,
  noteDataReducer,
} from "@/graphql/generated/reducers/note.reducer";
import { Payload, useHandleMutation } from "@/utils/data";
import { MutationHookOptions } from "@apollo/client";
import { Dispatch, useEffect, useReducer } from "react";

type NoteCreationMutationHookOptions = MutationHookOptions<
  { createNote: NoteFragment },
  NoteCreationArgs
>;

export const useCreateNote = (options?: NoteCreationMutationHookOptions) => {
  return useHandleMutation<{ createNote: NoteFragment }, NoteCreationArgs>(CREATE_NOTE, {
    ...updateCacheAfterCreatingNote,
    ...(options ?? {}),
  });
};

type NoteUpdateMutationHookOptions = MutationHookOptions<
  { updateNote: NoteFragment },
  NoteUpdateArgs
>;

export const useUpdateNote = (options?: NoteUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateNote: NoteFragment }, NoteUpdateArgs>(UPDATE_NOTE, options);
};

export const useNoteDataReducer = (data?: NoteData): [NoteData, Dispatch<Payload<NoteData>>] => {
  const user = useUser();
  const initializedData = initializeNoteData(data ?? { userId: user?.id as string });
  const [noteData, dispatchNoteData] = useReducer(
    noteDataReducer,
    initializedData,
    initializeNoteData
  );
  useEffect(() => {
    if (user?.id && !noteData?.userId) {
      console.log("Dispatching note data!");
      dispatchNoteData({ field: "userId", value: user.id });
    }
  }, [user, noteData]);
  return [noteData, dispatchNoteData];
};
