/* Do not edit this file. It was generated programmatically. */

import { NotebookCreationArgs, NotebookUpdateArgs } from "@/graphql/generated/args/notebook.args";
import { NotebookFragment } from "@/graphql/generated/fragments/notebook.fragment";
import {
  CREATE_NOTEBOOK,
  updateCacheAfterCreatingNotebook,
  UPDATE_NOTEBOOK,
} from "@/graphql/generated/mutations/notebook.mutations";
import {
  initializeNotebookData,
  NotebookData,
  notebookDataReducer,
} from "@/graphql/generated/reducers/notebook.reducer";
import { Payload, useHandleMutation } from "@/utils/data";
import { MutationHookOptions } from "@apollo/client";
import { Dispatch, useEffect, useReducer } from "react";
// import { useUser } from "@/components/contexts/UserContext";

type NotebookCreationMutationHookOptions = MutationHookOptions<
  { createNotebook: NotebookFragment },
  NotebookCreationArgs
>;

export const useCreateNotebook = (options?: NotebookCreationMutationHookOptions) => {
  return useHandleMutation<{ createNotebook: NotebookFragment }, NotebookCreationArgs>(
    CREATE_NOTEBOOK,
    {
      ...updateCacheAfterCreatingNotebook,
      ...(options ?? {}),
    }
  );
};

type NotebookUpdateMutationHookOptions = MutationHookOptions<
  { updateNotebook: NotebookFragment },
  NotebookUpdateArgs
>;

export const useUpdateNotebook = (options?: NotebookUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateNotebook: NotebookFragment }, NotebookUpdateArgs>(
    UPDATE_NOTEBOOK,
    options
  );
};

export const useNotebookDataReducer = (
  data: NotebookData
): [NotebookData, Dispatch<Payload<NotebookData>>] => {
  const initialData = initializeNotebookData(data);
  const [notebookData, dispatchNotebookData] = useReducer(
    notebookDataReducer,
    initialData,
    initializeNotebookData
  );
  useEffect(() => {
    if (data.userId && !notebookData?.userId) {
      console.log("Dispatching notebook data!");
      dispatchNotebookData({ field: "init", value: data });
    }
  }, [data, notebookData]);
  return [notebookData, dispatchNotebookData];
};
