/* Do not edit this file. It was generated programmatically. */

import { useUser } from "@/components/contexts/UserContext";
import { ListItemCreationArgs, ListItemUpdateArgs } from "@/graphql/generated/args/listItem.args";
import { ListItemFragment } from "@/graphql/generated/fragments/listItem.fragment";
import {
  CREATE_LIST_ITEM,
  getOptimisticResponseForListItemCreation,
  updateCacheAfterCreatingListItem,
  UPDATE_LIST_ITEM,
} from "@/graphql/generated/mutations/listItem.mutations";
import {
  initializeListItemData,
  ListItemData,
  listItemDataReducer,
} from "@/graphql/generated/reducers/listItem.reducer";
import {
  listItemCreationInputSchema,
  listItemUpdateInputSchema,
} from "@/graphql/generated/schemas/listItem.schemas";
import { Payload, useHandleMutation } from "@/utils/data";
import { MutationHookOptions } from "@apollo/client";
import { Dispatch, useEffect, useReducer } from "react";

type ListItemCreationMutationHookOptions = MutationHookOptions<
  { createListItem: ListItemFragment },
  ListItemCreationArgs
>;

export const useCreateListItem = (options?: ListItemCreationMutationHookOptions) => {
  return useHandleMutation<{ createListItem: ListItemFragment }, ListItemCreationArgs>(
    CREATE_LIST_ITEM,
    { ...updateCacheAfterCreatingListItem, ...(options ?? {}) },
    listItemCreationInputSchema,
    getOptimisticResponseForListItemCreation
  );
};

type ListItemUpdateMutationHookOptions = MutationHookOptions<
  { updateListItem: ListItemFragment },
  ListItemUpdateArgs
>;

export const useUpdateListItem = (options?: ListItemUpdateMutationHookOptions) => {
  return useHandleMutation<{ updateListItem: ListItemFragment }, ListItemUpdateArgs>(
    UPDATE_LIST_ITEM,
    options,
    listItemUpdateInputSchema
  );
};

export const useListItemDataReducer = (
  data?: ListItemData
): [ListItemData, Dispatch<Payload<ListItemData>>] => {
  const { user } = useUser();
  const starterData = data ?? {};
  const initializedData = initializeListItemData(starterData, user);
  const [listItemData, dispatchListItemData] = useReducer(
    listItemDataReducer,
    initializedData,
    initializeListItemData
  );
  useEffect(() => {
    if (user?.id && !listItemData?.userId) {
      dispatchListItemData({
        field: "init",
        value: initializeListItemData(listItemData, user),
      });
    }
  }, [user, listItemData]);
  return [listItemData, dispatchListItemData];
};
