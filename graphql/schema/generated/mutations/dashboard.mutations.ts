/* Do not edit this file. It was generated programmatically. */

import { CreateDashboardArgs } from "@/graphql/schema/generated/args/dashboard.args";
import {
  dashboardFragment,
  DashboardFragment,
} from "@/graphql/schema/generated/fragments/dashboard.fragment";
import {
  DashboardCreateInput,
  DashboardUpdateInput,
} from "@/graphql/schema/generated/inputs/dashboard.inputs";
import { gql, MutationHookOptions } from "@apollo/client";

export const CREATE_DASHBOARD = gql`
  mutation CreateDashboard($data: DashboardCreateInput!) {
    createDashboard(data: $data) {
      ...DashboardFragment
    }
  }
  ${dashboardFragment}
`;

export const getOptimisticResponseForDashboardCreation = (data: DashboardCreateInput) => {
  const now = new Date();
  return {
    createDashboard: {
      __typename: "Dashboard",
      id: "tmp-id",
      description: null,
      isDefault: null,
      public: null,
      archivedAt: null,
      ...data,
      createdAt: now,
      updatedAt: now,
    },
  };
};

export const updateCacheAfterCreatingDashboard: MutationHookOptions<
  { createDashboard: DashboardFragment },
  CreateDashboardArgs
> = {
  update(cache, { data }) {
    const { createDashboard } = data || {};
    if (createDashboard) {
      const newDashboardRef = cache.writeFragment({
        data: createDashboard,
        fragment: gql`
          fragment NewDashboard on Dashboard {
            ...DashboardFragment
          }
          ${dashboardFragment}
        `,
        fragmentName: "NewDashboard",
      });
      cache.modify({
        id: `User:${createDashboard.userId}`,
        fields: {
          dashboards(existingDashboardRefs = []) {
            return [...existingDashboardRefs, newDashboardRef];
          },
        },
      });
      cache.modify({
        fields: {
          dashboards(existingDashboards = []) {
            return [...existingDashboards, newDashboardRef];
          },
        },
      });
    }
  },
};

export const UPDATE_DASHBOARD = gql`
  mutation UpdateDashboard($where: DashboardWhereUniqueInput!, $data: DashboardUpdateInput!) {
    updateDashboard(where: $where, data: $data) {
      ...DashboardFragment
    }
  }
  ${dashboardFragment}
`;

export const getOptimisticResponseForDashboardUpdate = (
  fragment: DashboardFragment,
  data: DashboardUpdateInput
) => {
  const now = new Date();
  return {
    updateDashboard: {
      __typename: "Dashboard",
      ...fragment,
      ...data,
      updatedAt: now,
    },
  };
};

export const UPSERT_DASHBOARD = gql`
  mutation UpdateDashboard($where: DashboardWhereUniqueInput!, $data: DashboardCreateInput!) {
    upsertDashboard(where: $where, data: $data) {
      ...DashboardFragment
    }
  }
  ${dashboardFragment}
`;
