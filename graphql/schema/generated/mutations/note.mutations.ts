/* Do not edit this file. It was generated programmatically. */

import { CreateNoteArgs } from "@/graphql/schema/generated/args/note.args";
import { noteFragment, NoteFragment } from "@/graphql/schema/generated/fragments/note.fragment";
import { NoteCreateInput, NoteUpdateInput } from "@/graphql/schema/generated/inputs/note.inputs";
import { gql, MutationHookOptions } from "@apollo/client";

export const CREATE_NOTE = gql`
  mutation CreateNote($data: NoteCreateInput!) {
    createNote(data: $data) {
      ...NoteFragment
    }
  }
  ${noteFragment}
`;

export const getOptimisticResponseForNoteCreation = (data: NoteCreateInput) => {
  const now = new Date();
  return {
    createNote: {
      __typename: "Note",
      id: "tmp-id",
      body: null,
      public: null,
      archivedAt: null,
      ...data,
      createdAt: now,
      updatedAt: now,
    },
  };
};

export const updateCacheAfterCreatingNote: MutationHookOptions<
  { createNote: NoteFragment },
  CreateNoteArgs
> = {
  update(cache, { data }) {
    const { createNote } = data || {};
    if (createNote) {
      const newNoteRef = cache.writeFragment({
        data: createNote,
        fragment: gql`
          fragment NewNote on Note {
            ...NoteFragment
          }
          ${noteFragment}
        `,
        fragmentName: "NewNote",
      });
      cache.modify({
        id: `User:${createNote.userId}`,
        fields: {
          notes(existingNoteRefs = []) {
            return [...existingNoteRefs, newNoteRef];
          },
        },
      });
      cache.modify({
        fields: {
          notes(existingNotes = []) {
            return [...existingNotes, newNoteRef];
          },
        },
      });
    }
  },
};

export const UPDATE_NOTE = gql`
  mutation UpdateNote($where: NoteWhereUniqueInput!, $data: NoteUpdateInput!) {
    updateNote(where: $where, data: $data) {
      ...NoteFragment
    }
  }
  ${noteFragment}
`;

export const getOptimisticResponseForNoteUpdate = (
  fragment: NoteFragment,
  data: NoteUpdateInput
) => {
  const now = new Date();
  return {
    updateNote: {
      __typename: "Note",
      ...fragment,
      ...data,
      updatedAt: now,
    },
  };
};

export const UPSERT_NOTE = gql`
  mutation UpdateNote($where: NoteWhereUniqueInput!, $data: NoteCreateInput!) {
    upsertNote(where: $where, data: $data) {
      ...NoteFragment
    }
  }
  ${noteFragment}
`;
